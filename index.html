<!DOCTYPE html>
<html>
<head>
  <title>TopCodes Spelling Game</title>
  <link rel="stylesheet" type="text/css" href="styles.css">
</head>

<body>
  <div class="header">
    <div class="header-text">Spelling with Topcodes</div>
    <div class="img-button-container">
      <div class="cameraButton" id="headerButton1" onclick="startImage(1, 'video-canvas')">Image 1</div>
      <div class="cameraButton" id="headerButton2" onclick="startImage(2, 'video-canvas')">Image 2</div>
      <div class="cameraButton" id="headerButton3" onclick="startImage(3, 'video-canvas')">Image 3</div>
      <div class="cameraButton" id="headerButton4" onclick="startImage(4, 'video-canvas')">Image 4</div>
      <div class="cameraButton" id="headerButton5" onclick="startImage(5, 'video-canvas')">Image 5</div>
      <div class="cameraButton" id="headerButton6" onclick="startImage(6, 
      'video-canvas')"> Check if Word </div>
    </div>
  </div>
  <div class="row">
    <div class="col1">
      <div class="image-container">
        <div class="image image-0" id="image-obj">a</div>
      </div>
      <div class="word-container" id="word-container">
        <div class="word" id="word">YOUR WORD:</div>
        <div class="hint" id="hint">HINT: </div>
      </div>
    </div>
    <div class="canvas-container">
      <div class="canvas-obj">
        <canvas id="video-canvas" width="800" height="600" style="background: #000;"></canvas>
      </div>
      <div class="canvas-buttons">
        <!-- <button class="cameraButton cameraButtonCanvas" id="camera-button" onclick="TopCodes.startVideoScan('video-canvas')">Start</button> -->
        <button class="cameraButton cameraButtonCanvas" id="camera-button" onclick="TopCodes.stopVideoScan('video-canvas')">Stop</button>
      </div>
    </div>
  </div>
  <br/>
  <!-- <button class="cameraButton" id="camera-button" onclick="TopCodes.startVideoScan('video-canvas')">Start</button> -->
  <!-- <div class="img-button-container"> -->
  <!--   <button class="cameraButton button1Color" onclick="startImage(1, 'video-canvas')">Image 1</button> -->
  <!--   <button class="cameraButton button2Color" onclick="startImage(2, 'video-canvas')">Image 2</button> -->
  <!--   <button class="cameraButton button3Color" onclick="startImage(3, 'video-canvas')">Image 3</button> -->
  <!--   <button class="cameraButton button4Color" onclick="startImage(4, 'video-canvas')">Image 4</button> -->
  <!--   <button class="cameraButton button5Color" onclick="startImage(5, 'video-canvas')">Image 5</button> -->
  <!-- </div> -->
  <!-- <button class="cameraButton" id="camera-button" onclick="TopCodes.stopVideoScan('video-canvas')">Stop</button> -->
  <div class="instructions">
    Instructions: <br>
    Click an 'Image' button to start the camera and show an image(You may have to accept the camera starting). Spell out the word shown in the image
    with the block letters and show the codes to the camera. If the spelling is correct, the text will turn green. Click 'Stop' to stop
    the camera at any time. 
  </div>

  <script src="topcodes.js"></script>
  <script src="javascript.js" type="text/javascript"></script>
  <script>

  // var $numberOfBlocks = document.getElementById('number');
  var $wordStr = document.getElementById('word');
  var codeLetterMap = {
    31: 'A',
    47: 'B',
    55: 'C',
    59: 'D',
    61: 'E',
    79: 'F',
    87: 'G',
    91: 'H',
    93: 'I',
    103: 'J',
    107: 'K',
    109: 'L',
    115: 'M',
    117: 'N',
    121: 'O',
    143: 'P',
    151: 'Q',
    155: 'R',
    157: 'S',
    167: 'T',
    171: 'U',
    173: 'V',
    179: 'W',
    181: 'X',
    185: 'Y',
    199: 'Z'
  }

  // register a callback function with the TopCode library
  TopCodes.setVideoFrameCallback("video-canvas", function(jsonString) {

    // convert the JSON string to an object
    var json = JSON.parse(jsonString);

    // get the list of topcodes from the JSON object
    var topcodes = json.topcodes;

    // obtain a drawing context from the <canvas>
    var ctx = document.querySelector("#video-canvas").getContext('2d');

    // draw a circle over the top of each TopCode
    ctx.fillStyle = "rgba(255, 255, 0, 0.3)";   // very translucent red
    console.log("LENGTH", topcodes.length)
    var numStr = "Number of Blocks: " + topcodes.length
    var lettersStr = "YOUR WORD: "
    <!-- $numberOfBlocks.innerHTML = numStr; -->
    for (i=0; i<topcodes.length; i++) {
      // console.log("A CODE:" + topcodes[i].code + ", letter:" + codeLetterMap[topcodes[i].code])
      lettersStr = lettersStr + codeLetterMap[topcodes[i].code]
      ctx.beginPath();
      ctx.arc(topcodes[i].x, topcodes[i].y, topcodes[i].radius, 0, Math.PI*2, true);
      ctx.fill();
    }
    $wordStr.innerHTML = lettersStr;
    var checkResult = checkWord(lettersStr)
    if(checkResult){
      TopCodes.stopVideoScan('video-canvas')
    }
  });
  </script>
</body>
</html>
